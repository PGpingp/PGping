<!DOCTYPE html>
<html>
  <head><title>Soundodger</title>
   <script src="https://code.jquery.com/jquery-3.1.1.js"></script>
   	<script src = "https://cdn.jsdelivr.net/sweetalert2/6.6.2/sweetalert2.min.js"></script>
		<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/sweetalert2/6.6.2/sweetalert2.min.css">
		<script src="https://cdnjs.cloudflare.com/ajax/libs/core-js/2.4.1/core.js"></script>
			<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.css" />
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.css" />
		<script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.js"></script>
   </head>
<body>
  <div id="audio8"></div>
  <div id='main-menu' class='menu'>
      <button id='start-game' onclick='selectLvl()'>
          start game
      </button>
     <!--- <button id='level-editor' onclick='selectLvl()'>
          Level creator (coming soon)...
      </button>-->
      <button id='Tutorial' onclick='tutorial()'>
          How to play
      </button>
      <button id='settings-button' onclick='settings()'>
          settings
      </button>
      <button id='creator' onclick="credits()">Credits</button>
      <button id='original'><a href='http://soundodger.com/'>Check out the original game</a></button>
  </div>
  
  <div id='settings' class='menu'>
	Settings:
	<button class='back' onclick='back()'>
	  back</button>
	<br/><br/>
	<div class='parameter'>
	  input adjustment: x<span id='ia'>1</span><br/>
	  <input id='in-adjust' type='range' min='8' max='30' value='10' onchange='document.getElementById("ia").innerText = document.getElementById("in-adjust").value/10'>
	  <div class='tip'>
		Movement speed:<br/>
		Default: x1 (no multiplier)
	  </div>
	</div>
	<div class='parameter'>
	  Quality: <span id='q'>4</span><br/>
	  <input id='quality' type='range' min='1' max='7' value='4' onchange='document.getElementById("q").innerText = document.getElementById("quality").value'>
	  <div class='tip'>
		Quality:<br/>
		1-2: Low cpu and memory<br/>
		3-4: mobile<br/>
		5: good graphics<br/>
		6-7: Intensive<span style='color:black; text-shadow:0 0 1px red'>
		  (may consume CPU)</span>
	  </div>
	</div>
  </div>
  
  <div id='level-selector' class='menu'>
	Level selector:
	<button class='back' onclick='back()'>
	  back</button>
	<br/><br/>
	<div id='lv_0' class='level'>
	  <span class='progress'>0%</span>
	  Beginings<br/>by Rull Deef<br/>â­• 6 ðŸ•’ 33s
	  <span style='color:red'>extremeðŸ”¥</span>
	</div>
  </div>
  
  <div id='score-div' onclick='back()'>
	<br /> <br /> <br /> <br />
	<span id='Score'>100%</span>
	Continue
  </div>
  
  <div id='editor'>
	<div id='level-manager' class='menu'>
	  <br/>Tap level to start editing it!<br/>
	  <button id='new-lvl'>create new level</button>
	</div>
	
	<div id='meta-editor' class='menu'>
	  Edit meta:<br/>
	  Title: <input id='meta-title'><br/>
	  Author: <input id='meta-author'><br/>
	  Enemies: <input id='meta-enemies'><br/>
	  Duration: <input id='meta-duration'><br/>
	  Difficulty: <input id='meta-difficulty' list='diff-list'><br/>
	  <datalist id='diff-list'>
		<option value='easy'/>
		<option value='normal'/>
		<option value='medium'/>
		<option value='hard'/>
		<option value='hardest'/>
		<option value='extreme'/>
		<option value='impossible'/>
		<option value='devil'/>
	  </datalist>
	  Bullet A: <input id='meta-color1' type='color'><br/>
	  Bullet B: <input id='meta-color2' type='color'><br/>
	  Homing: <input id='meta-color3' type='color'><br/>
	  Bubble: <input id='meta-color4' type='color'><br/>
	  Outline: <input id='meta-color5' type='color'><br/>
	  Advanced: <input id='meta-advanced' type='checkbox'>
	</div>
	
	<div id='level-editor' class='menu'>
	  <!-- timeline management -->
	  <button id='time-left2'>&lt;-&lt;-</button>
	  <button id='time-left1'>&lt;-</button>
	  <button id='time-right1'>-&gt;</button>
	  <button id='time-right2'>-&gt;-&gt;</button>
	  <button id='time-play'>play</button>
	  <button id='time-stop'>stop</button>
	  
	  <div id='timeline'>
		<div id='curr-pos'></div>
	  </div>
	  
	  <!-- bullets holder -->
	  <div id='bullet-view'>
		  <div class='bullet-spike'></div>
	  </div>
	  
	  <!-- spins holder -->
	  <div id='spin-view'>
		  <div class='spin-dot'></div>
	  </div>
	  
	  <!-- switchers between bullet and spin views -->
	  <button id='to-bullet-view'>bullets</button>
	  <button id='to-spin-view'>spins</button>
	  
	  <!-- inspector for picked element -->
	  <div id='inspector'>
		<div id='empty-inspect'>
		  Pick a bullet or a spin dot
		</div>
		<div id='bullet-inspect'>
		  type: <input id='insp-type'><br/>
		  enemy: <input id='insp-enemy'><br/>
		  amount: <input id='insp-amount'><br/>
		  speed: <input id='insp-bspeed'><br/>
		  cone: <input id='insp-cone'><br/>
		  offset: <input id='insp-offset'><br/>
		  time: <input id='insp-btime'><br/>
		  duration: <input id='insp-duration'><br/>
		  to player: <input id='insp-to-player' type='checkbox'>
		</div>
		<div id='spin-inspect'>
		  time: <input id='insp-stime'><br/>
		  speed: <input id='insp-sspeed'>
		</div>
	  </div>
	  
	  <!-- creation bullet/spin button -->
	  <button id='new-bul-spin'>
		+new</button>
	  <button id='del-bul-spin'>
		-del</button>
	  
	  <canvas id='editor-canvas'
		  width='600' height='800'>
		Sorry, but your browser can't load canvas :c
	  </canvas>
	</div>
	
	<button id='return' class='back' onclick='back()'>
	  back</button>
	<button id='save' class='back'>save</button>
	<button id='to-meta' class='back'>meta</button>
  </div>
  
  <div id='pause-menu' class='menu'>
	Paused
	<button id='pause-continue' onclick='pause()'>
	  continue</button>
	<button id='pause-return' onclick='endGame()'>
	  end game</button>
  </div>
  
  <button id='pause-button' onclick='pause()'>Pause</button>
  
  <canvas id='canvas' width='600' height='800'>
	Sorry, your browser can't load canvas element :(
  </canvas>
  
  <script> 
 
// ####################
// ====================

  // main gui script
	setTimeout(() => {
	  /*console.log('update log: styles added! Use color1 and color2 for triangle bullets, color3 for followers, color4 for balls and color5 for outline.\nAlso added advanced mode (level background becomes dark)');*/
	}, 100);
	
	let
	mmenu = document.getElementById('main-menu'),
	lsel = document.getElementById('level-selector'),
	stgs = document.getElementById('settings'),
	scrd = document.getElementById('score-div'),
	pmenu = document.getElementById('pause-menu'),
	pbtn = document.getElementById('pause-button'),
	edtr = document.getElementById('editor'),
	mngr = document.getElementById('level-manager'),
	edlv = document.getElementById('level-editor'),
	level;
	
	function Show(...what) {
		what.map(el => {el.style.display = 'block'})
	}
	function Hide(...what) {
		what.map(el => {el.style.display = 'none'})
	}
	
	function selectLvl() {
	  Hide(mmenu); Show(lsel);
	  loadLevels();
	}
	
	var warning;
	function toEditor() {
	  Hide(mmenu); Show(edtr);
	  LevelEditor.enter();
	  if(warning == undefined) {
		alert('âš  warning âš \n\nLevel editor is too raw  and has a lot of bugs and incompleted features.\n\nPlease, if you really want to use it, dont get upset when something might works wrong.\n\nCompleted version will be presented as soon as possible. Dont forget to upvote my work if you enjoyed it :)');
		if(confirm('wanna some explanation about editor?')) {
		  alert('read console output for getting info whenever you need');
		  console.log('===== [EDITOR HELP] =====\nFirstly you start level editor you will be redirected to level selector screen. Choose here level, which one you want to edit, or tap "create new" to add new level to the list.\n\nNext you will see meta editor. Here you can change basics of level data: title, author\'s name, enemies count, level duration difficulty, color theme and at last choose whither this is an advanced level or not. After changing values you can save them (by pressing save button) or revert changes (back button).\n\nNo matter which button you press, next you will see exactly level editor, when you can change bullets and enemies\' spins.');
		  console.log('===== [EXACTLY LEVEL EDITOR HELP] =====\nTimeline:\n\tAt the bottom you can find ribbon with blue or green dots on it and some buttons - this is timeline handlers.\n"Arrow" buttons manage current time position (red line).\nPlay button begins testing of what you create from current time position (if you press it again - testing will be paused). Stop button stops testing and flushes current time position to begin.\n"Bullets" and "spins" buttons are switchers between bullet view (blue dots) and spin view (green dots)\n"+new" and "-del" creates to and deletes from button/spin timeline.\n\nInspector:\n\tWhen you press any dot in timeline it will be picked and colored red. Picked object will be sent to inspector (which locates on top right of the screen). There you can see and change all parameters of the picked object.');
		  console.log('good luck and have fun when creating your own levels ;)');
		}
		warning = 'presented';
	  }
	}
	
	function back() {
	  Hide(lsel, stgs, scrd, pbtn, pmenu, edtr);
	  Show(mmenu);
	  
	  // applying settings
	  Input.adjustment = document.getElementById
		('in-adjust').value/10;
	  Settings.quality = document.getElementById('quality').value;
	}
      function tutorial() {
          swal({
              title: 'How to play',
              type: "info",
              html: true,
              text: 'Controls: use Mouse or finger to drag circle around and avoid the obstacles.',
              confirmButtonText: 'Ok'
          })

      }
	function save() {
		console.log('saved');
	}
	
	function beginGame(lvl) {
	  Hide(lsel); Show(pbtn);
	}
	
	function settings() {
	  Hide(mmenu); Show(stgs);
	}
	
      function showScore(lvl, score) {
        
              //ClearInterval(x);
              score + '%';
              if (score < 100) {
              swal({
                  title: '<br /><br /><p id="score"></p>',
                  type: "error",
                  html: true,
                  text: "You did not dodge all the bullets!",
                  confirmButtonText: 'Menu',
                  closeOnClickOutside: true,
                  closeOnEsc: true,
                  confirmButtonColor: 'Green',


              }, function (isConfirm) {
                  if (isConfirm) {
                      back();
                  } else {
                     /* $("body").css("background-color", "#f0f0f0");
                      $("#complete").html("");
                      $("#b_menu,#b_next,#level,#moves").hide();
                      $("#info,#mainpath,#maincircle,#div_levels,#lighton").show();
                      $(".blocks").remove();
                      clearTimeout(countdown);
                      var x = document.getElementById("time")
                      x.style.visibility = "hidden";*/
                  }
                  })
              }

              else
              {
                  swal({
                      title: '100%',
                      type: "success",
                      text: "Level complete",
                      confirmButtonText: 'Menu',
                      closeOnClickOutside: true,
                      closeOnEsc: true,
                      confirmButtonColor: 'Green',


                  }, function (isConfirm) {
                      if (isConfirm) {
                          back();
                      } else {
                          /*$("body").css("background-color", "#f0f0f0");
                          $("#complete").html("");
                          $("#b_menu,#b_next,#level,#moves").hide();
                          $("#info,#mainpath,#maincircle,#div_levels,#lighton").show();
                          $(".blocks").remove();
                          clearTimeout(countdown);
                          var x = document.getElementById("time");
                          x.style.visibility = "hidden";*/
                      }
                  })
              }

          
	 document.getElementById('score').
		innerText = score + '%';
          document.getElementById('Score').
              innerText = score + '%';


	  
	  userScores[lvl] = 
		Math.max(userScores[lvl], score);
	}
	
	function pause() {
	    var vid = document.getElementById("audiobox"); 
	  if(Time.paused) { Hide(pmenu); Time.resume(); vid.play(); }
	  else { Time.pause(); Show(pmenu); vid.pause(); }
	}
	
	function endGame() {
	  level.end();
	  delete level;
	  back(); Time.resume();
	  $( ".audio8" ).empty();
	}
	
      function playLevel(lvl, i) {
	     x = levelsData[lvl];
	  	if(x.title == "Darkness"){
	  $(function() {
  $("#audio8").html('<audio controls autoplay id="audiobox"><source src="https://www.dropbox.com/s/dpp26ukcpqldmgn/audio1.wav?dl=1" type="audio/wav"></audio>');
});}
else if(x.title == "Global domination"){
 $(function() {
  $("#audio8").html('<audio controls autoplay id="audiobox"><source src="https://www.dropbox.com/s/7vx6i95z26g3n7q/Midnight%20House%2013%2009%202018%2C%2020.45.m4a?dl=1" type="audio/wav"></audio>');
});}
else if(x.title == "No sight"){
 $(function() {
  $("#audio8").html('<audio controls autoplay id="audiobox"><source src="https://www.dropbox.com/s/1p5921j4m2god04/Retro%20Funk%2011%2009%202018%2C%2019.32.wav?dl=1" type="audio/wav"></audio>');
                });
        }
       // clearTimeout(time);
        level = new Level(lvl);
        level.preloadData(levelsData[lvl]);
        level.quality = Settings.quality;
        Time.reset(); Time.resume();
        level.start();/*
          time = setTimeout(function start(lvl, i) {
             // clearTimeout(time);
              alert(levelsData[i])
              // clearTimeout(time);
              level = new Level(lvl);
              level.preloadData(levelsData[lvl]);
              level.quality = Settings.quality;
              Time.reset(); Time.resume();
              level.start();
          }, 2000);*/
	  }
      
	function loadLevels() {
	  let lvls = document.
		getElementsByClassName('level');
	  for(let i = lvls.length; i-- > 0;)
		  lvls[i].parentNode.removeChild(lvls[i]);
	  
	  for(let i = 0; i < levelsData.length; i++) {
		let el = document.createElement('div');
		el.className = 'level';
		el.id = 'level_' + i;
		
		let data = levelsData[i];
		
		// creating progress span
		let score = document.createElement('span');
		score.className = 'progress';
		score.innerText = 
		  (userScores[i] || '0') + '%';
		el.appendChild(score);
		
		// creating info
		el.innerHTML += (data.title || 'untitled')
		+ '<br/>by ' + (data.author || 'unknown')
		+ '<br/> Enemies: ' + (data.enemies || '?')
		+ ' | Duration and Difficulty: ' + (data.duration || '?')
		+ ' ' + (data.difficulty || '?');
		if(data.advanced)
		  el.innerHTML += ' [advanced]';
		
          lsel.appendChild(el);
		el.onclick = function() {
            beginGame(); playLevel(i);
           // time = setTimeout(starting(i), 1600);
		}
	  }
	}
	
   // var inputAdjustment = 1;
	var userScores = [0,0,0,0,0]; // for each level
	var levelsData = [
	  {	title: "Go",	author: "FireCubeStudios",	enemies: 3,	duration: 70,	difficulty: "Simple",	advanced: false,	color1: "#ff7f7f",	color2: "#c9990b",	color3: "#007fa6",	color4: "#8b31ab",	color5: "#002a4d",	spins: [		{ time: 0, speed: 0 },		{ time: 10, speed: 60 },		{ time: 2, speed: 0 },		{ time: 19, speed: 60 },		{ time: 21, speed: -120 },		{ time: 30, speed: -120 },		{ time: 37, speed: 120 },		{ time: 34, speed: 0 },		{ time: 53, speed: 120 },		{ time: 62, speed: 0 },	],	bullets: [		{type: 1,		 id: 0,		 amount: 1,		 speed: 150,		 cone: 0,		 offset: 0,		 time: 5,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 1,		 amount: 1,		 speed: 150,		 cone: 0,		 offset: 0,		 time: 7,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 2,		 amount: 1,		 speed: 150,		 cone: 0,		 offset: 0,		 time: 9,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 0,		 amount: 3,		 speed: 150,		 cone: 30,		 offset: 0,		 time: 13,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 1,		 amount: 7,		 speed: 150,		 cone: 60,		 offset: 0,		 time: 15,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 2,		 amount: 11,		 speed: 150,		 cone: 90,		 offset: 0,		 time: 17,		 duration: 0,		 toPlayer: true},		{type: 2,		 id: 0,		 amount: 1,		 speed: 100,		 cone: 0,		 offset: 30,		 time: 21,		 duration: 0,		 toPlayer: false},		{type: 2,		 id: 1,		 amount: 1,		 speed: 105,		 cone: 0,		 offset: 30,		 time: 21.5,		 duration: 0,		 toPlayer: false},		{type: 2,		 id: 2,		 amount: 1,		 speed: 110,		 cone: 0,		 offset: 30,		 time: 22,		 duration: 0,		 toPlayer: false},		{type: 2,		 id: 0,		 amount: 1,		 speed: 115,		 cone: 0,		 offset: 30,		 time: 22.5,		 duration: 0,		 toPlayer: false},		{type: 2,		 id: 1,		 amount: 1,		 speed: 120,		 cone: 0,		 offset: 30,		 time: 23,		 duration: 0,		 toPlayer: false},		{type: 2,		 id: 2,		 amount: 1,		 speed: 125,		 cone: 0,		 offset: 30,		 time: 23.5,		 duration: 0,		 toPlayer: false},		{type: 2,		 id: 0,		 amount: 1,		 speed: 130,		 cone: 0,		 offset: 30,		 time: 24,		 duration: 0,		 toPlayer: false},		{type: 2,		 id: 1,		 amount: 1,		 speed: 135,		 cone: 0,		 offset: 30,		 time: 24.5,		 duration: 0,		 toPlayer: false},		{type: 2,		 id: 2,		 amount: 1,		 speed: 140,		 cone: 0,		 offset: 30,		 time: 25,		 duration: 0,		 toPlayer: false},		{type: 2,		 id: 0,		 amount: 1,		 speed: 145,		 cone: 0,		 offset: 30,		 time: 25.5,		 duration: 0,		 toPlayer: false},		{type: 2,		 id: 1,		 amount: 1,		 speed: 150,		 cone: 0,		 offset: 30,		 time: 26,		 duration: 0,		 toPlayer: false},		{type: 2,		 id: 2,		 amount: 1,		 speed: 155,		 cone: 0,		 offset: 30,		 time: 26.5,		 duration: 0,		 toPlayer: false},		{type: 2,		 id: 0,		 amount: 1,		 speed: 160,		 cone: 0,		 offset: 30,		 time: 27,		 duration: 0,		 toPlayer: false},		{type: 2,		 id: 1,		 amount: 1,		 speed: 165,		 cone: 0,		 offset: 30,		 time: 27.5,		 duration: 0,		 toPlayer: false},		{type: 2,		 id: 2,		 amount: 1,		 speed: 170,		 cone: 0,		 offset: 30,		 time: 28,		 duration: 0,		 toPlayer: false},		{type: 2,		 id: 0,		 amount: 1,		 speed: 175,		 cone: 0,		 offset: 30,		 time: 28.5,		 duration: 0,		 toPlayer: false},		{type: 2,		 id: 1,		 amount: 1,		 speed: 180,		 cone: 0,		 offset: 30,		 time: 29,		 duration: 0,		 toPlayer: false},		{type: 2,		 id: 2,		 amount: 1,		 speed: 185,		 cone: 0,		 offset: 30,		 time: 29.5,		 duration: 0,		 toPlayer: false},		{type: 2,		 id: 0,		 amount: 4,		 speed: 100,		 cone: 60,		 offset: 0,		 time: 30,		 duration: 0,		 toPlayer: false},		{type: 2,		 id: 1,		 amount: 4,		 speed: 100,		 cone: 60,		 offset: 0,		 time: 30,		 duration: 0,		 toPlayer: false},		{type: 2,		 id: 2,		 amount: 4,		 speed: 100,		 cone: 60,		 offset: 0,		 time: 30,		 duration: 0,		 toPlayer: false},		{type: 1,		 id: 0,		 amount: 1,		 speed: 300,		 cone: 0,		 offset: 0,		 time: 37,		 duration: 7,		 toPlayer: false},		{type: 1,		 id: 2,		 amount: 1,		 speed: 300,		 cone: 0,		 offset: 0,		 time: 45,		 duration: 7,		 toPlayer: false},		{type: 1,		 id: 1,		 amount: 1,		 speed: 300,		 cone: 0,		 offset: 0,		 time: 53,		 duration: 3,		 toPlayer: false},		{type: 2,		 id: 0,		 amount: 2,		 speed: 300,		 cone: 60,		 offset: 0,		 time: 56,		 duration: 5,		 toPlayer: false},		{type: 2,		 id: 2,		 amount: 2,		 speed: 300,		 cone: 60,		 offset: 0,		 time: 56,		 duration: 5,		 toPlayer: false},		{type: 2,		 id: 1,		 amount: 2,		 speed: 300,		 cone: 60,		 offset: 0,		 time: 56,		 duration: 5,		 toPlayer: false},		{type: 1,		 id: 0,		 amount: 5,		 speed: 180,		 cone: 60,		 offset: 0,		 time: 63,		 duration: 0,		 toPlayer: false},		{type: 2,		 id: 0,		 amount: 4,		 speed: 165,		 cone: 45,		 offset: 0,		 time: 64,		 duration: 0,		 toPlayer: false},		{type: 1,		 id: 0,		 amount: 5,		 speed: 150,		 cone: 60,		 offset: 0,		 time: 65,		 duration: 0,		 toPlayer: false},		{type: 1,		 id: 1,		 amount: 5,		 speed: 180,		 cone: 60,		 offset: 0,		 time: 63,		 duration: 0,		 toPlayer: false},		{type: 2,		 id: 1,		 amount: 4,		 speed: 165,		 cone: 45,		 offset: 0,		 time: 64,		 duration: 0,		 toPlayer: false},		{type: 1,		 id: 1,		 amount: 5,		 speed: 150,		 cone: 60,		 offset: 0,		 time: 65,		 duration: 0,		 toPlayer: false},		{type: 1,		 id: 2,		 amount: 5,		 speed: 180,		 cone: 60,		 offset: 0,		 time: 63,		 duration: 0,		 toPlayer: false},		{type: 2,		 id: 2,		 amount: 4,		 speed: 165,		 cone: 45,		 offset: 0,		 time: 64,		 duration: 0,		 toPlayer: false},		{type: 1,		 id: 2,		 amount: 5,		 speed: 150,		 cone: 60,		 offset: 0,		 time: 65,		 duration: 0,		 toPlayer: false},	]},
	  {	title: "Global domination",	author: "FireCubeStudios",	enemies: 6,	duration: 33,	difficulty: "Hard",	advanced: false,	color1: "#9966ff",	color2: "#ff6666",	color3: "#ff9933",	color4: "#ffffcc",	color5: "#00cc99",	spins: [		{ time: 0, speed: 0 },		{ time: 1, speed: 60 },		{ time: 2, speed: -180 },		{ time: 5, speed: -180 },		{ time: 8, speed: -90 },		{ time: 9, speed: -90 },		{ time: 10, speed: 180 },		{ time: 12, speed: 90 },		{ time: 12.5, speed: 0 },		{ time: 13, speed: 0 },		{ time: 14, speed: 180 },		{ time: 14.5, speed: -270 },		{ time: 16, speed: 90 },		{ time: 20, speed: 0 },		{ time: 21, speed: -90 },		{ time: 23, speed: -90 },		{ time: 24, speed: -270 },		{ time: 24.7, speed: 90 },		{ time: 25.6, speed: -60 },		{ time: 26.5, speed: 180 },		{ time: 27.5, speed: -60 },		{ time: 30, speed: 0 },	],	bullets: [		{type: 2,		 id: 0,		 amount: 1,		 speed: 200,		 cone: 0,		 offset: 0,		 time: 2,		 duration: 0,		 toPlayer: true},		{type: 3,		 id: 4,		 amount: 1,		 speed: 200,		 cone: 0,		 offset: 0,		 time: 3.7,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 2,		 amount: 1,		 speed: 200,		 cone: 0,		 offset: 0,		 time: 5,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 3,		 amount: 3,		 speed: 200,		 cone: 30,		 offset: 0,		 time: 6.5,		 duration: 0,		 toPlayer: false},		{type: 1,		 id: 5,		 amount: 3,		 speed: 200,		 cone: 30,		 offset: 0,		 time: 8.5,		 duration: 0,		 toPlayer: false},		{type: 1,		 id: 0,		 amount: 1,		 speed: 200,		 cone: 0,		 offset: 0,		 time: 10,		 duration: 4,		 toPlayer: true},		{type: 1,		 id: 0,		 amount: 2,		 speed: 200,		 cone: 30,		 offset: 0,		 time: 15,		 duration: 3,		 toPlayer: false},		{type: 1,		 id: 4,		 amount: 1,		 speed: 200,		 cone: 0,		 offset: 0,		 time: 15.8,		 duration: 0,		 toPlayer: false},		{type: 1,		 id: 3,		 amount: 1,		 speed: 200,		 cone: 0,		 offset: 0,		 time: 16.5,		 duration: 0,		 toPlayer: false},		{type: 1,		 id: 2,		 amount: 1,		 speed: 200,		 cone: 0,		 offset: 0,		 time: 17.2,		 duration: 0,		 toPlayer: false},		{type: 1,		 id: 3,		 amount: 3,		 speed: 200,		 cone: 180,		 offset: 0,		 time: 18.5,		 duration: 0,		 toPlayer: false},		{type: 1,		 id: 3,		 amount: 3,		 speed: 200,		 cone: 60,		 offset: 0,		 time: 20.5,		 duration: 0,		 toPlayer: true},		{type: 2,		 id: 3,		 amount: 1,		 speed: 200,		 cone: 0,		 offset: 0,		 time: 22,		 duration: 2,		 toPlayer: true},		{type: 4,		 id: 5,		 amount: 2,		 speed: 200,		 cone: 60,		 offset: 0,		 time: 23,		 duration: 4,		 toPlayer: false},		{type: 3,		 id: 1,		 amount: 1,		 speed: 200,		 cone: 0,		 offset: 0,		 time: 25,		 duration: 3,		 toPlayer: true},		{type: 1,		 id: 0,		 amount: 5,		 speed: 200,		 cone: 90,		 offset: 0,		 time: 28.5,		 duration: 0,		 toPlayer: false},		{type: 1,		 id: 3,		 amount: 5,		 speed: 200,		 cone: 60,		 offset: 0,		 time: 29,		 duration: 0,		 toPlayer: false},		{type: 1,		 id: 0,		 amount: 5,		 speed: 200,		 cone: 30,		 offset: 0,		 time: 29.5,		 duration: 0,		 toPlayer: false},		{type: 1,		 id: 3,		 amount: 5,		 speed: 200,		 cone: 60,		 offset: 0,		 time: 30,		 duration: 0,		 toPlayer: false},	]},
	  {	title: "Pain lane",	author: "FireCubeStudios",	enemies:6,	duration: 100,	difficulty: "Impossible",	advanced: true,	color1: "#ffffff",	color2: "#567825",	color3: "#7e59c7",	color4: "#ffffff",	color5: "#ffffa1",	spins: [		{ time: 0, speed: 0 },		{ time: 5, speed: 90 },		{ time: 18, speed: 90 },		{ time: 22, speed: -250 },		{ time: 60, speed: -250 },		{ time: 65, speed: 0 },		{ time: 84, speed: 0 },		{ time: 90, speed: 200 },		{ time: 100, speed: 0 },	],	bullets: [		{type: 3,		 id: 0,		 amount: 1,		 speed: 150,		 cone: 0,		 offset: 0,		 time: 0,		 duration: 17,		 toPlayer: false},		{type: 3,		 id: 1,		 amount: 1,		 speed: 150,		 cone: 0,		 offset: 0,		 time: 0,		 duration: 17,		 toPlayer: false},		{type: 3,		 id: 2,		 amount: 1,		 speed: 150,		 cone: 0,		 offset: 0,		 time: 0,		 duration: 17,		 toPlayer: false},		{type: 4,		 id: 4,		 amount: 3,		 speed: 200,		 cone: 80,		 offset: 20,		 time: 22,		 duration: 17,		 toPlayer: false},		{type: 4,		 id: 3,		 amount: 3,		 speed: 200,		 cone: 80,		 offset: 20,		 time: 22,		 duration: 17,		 toPlayer: false},		{type: 4,		 id: 5,		 amount: 3,		 speed: 200,		 cone: 80,		 offset: 20,		 time: 22,		 duration: 17,		 toPlayer: false},		{type: 1,		 id: 0,		 amount: 1,		 speed: 100,		 cone: 0,		 offset: 0,		 time: 25,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 1,		 amount: 1,		 speed: 100,		 cone: 0,		 offset: 0,		 time: 25,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 1,		 amount: 1,		 speed: 100,		 cone: 0,		 offset: 0,		 time: 26,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 1,		 amount: 1,		 speed: 100,		 cone: 0,		 offset: 0,		 time: 27,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 1,		 amount: 1,		 speed: 100,		 cone: 0,		 offset: 0,		 time: 28,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 1,		 amount: 1,		 speed: 100,		 cone: 0,		 offset: 0,		 time: 29,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 1,		 amount: 1,		 speed: 100,		 cone: 0,		 offset: 0,		 time: 30,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 1,		 amount: 1,		 speed: 100,		 cone: 0,		 offset: 0,		 time: 31,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 1,		 amount: 1,		 speed: 100,		 cone: 0,		 offset: 0,		 time: 32,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 1,		 amount: 1,		 speed: 100,		 cone: 0,		 offset: 0,		 time: 33,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 1,		 amount: 1,		 speed: 100,		 cone: 0,		 offset: 0,		 time: 34,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 1,		 amount: 1,		 speed: 100,		 cone: 0,		 offset: 0,		 time: 35,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 1,		 amount: 1,		 speed: 100,		 cone: 0,		 offset: 0,		 time: 36,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 1,		 amount: 1,		 speed: 100,		 cone: 0,		 offset: 0,		 time: 37,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 0,		 amount: 1,		 speed: 100,		 cone: 0,		 offset: 0,		 time: 26,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 0,		 amount: 1,		 speed: 100,		 cone: 0,		 offset: 0,		 time: 27,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 0,		 amount: 1,		 speed: 100,		 cone: 0,		 offset: 0,		 time: 28,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 0,		 amount: 1,		 speed: 100,		 cone: 0,		 offset: 0,		 time: 29,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 0,		 amount: 1,		 speed: 100,		 cone: 0,		 offset: 0,		 time: 30,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 0,		 amount: 1,		 speed: 100,		 cone: 0,		 offset: 0,		 time: 31,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 0,		 amount: 1,		 speed: 100,		 cone: 0,		 offset: 0,		 time: 32,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 0,		 amount: 1,		 speed: 100,		 cone: 0,		 offset: 0,		 time: 33,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 0,		 amount: 1,		 speed: 100,		 cone: 0,		 offset: 0,		 time: 34,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 0,		 amount: 1,		 speed: 100,		 cone: 0,		 offset: 0,		 time: 35,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 0,		 amount: 1,		 speed: 100,		 cone: 0,		 offset: 0,		 time: 36,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 0,		 amount: 1,		 speed: 100,		 cone: 0,		 offset: 0,		 time: 37,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 2,		 amount: 1,		 speed: 100,		 cone: 0,		 offset: 0,		 time: 25,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 2,		 amount: 1,		 speed: 100,		 cone: 0,		 offset: 0,		 time: 26,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 2,		 amount: 1,		 speed: 100,		 cone: 0,		 offset: 0,		 time: 27,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 2,		 amount: 1,		 speed: 100,		 cone: 0,		 offset: 0,		 time: 28,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 2,		 amount: 1,		 speed: 100,		 cone: 0,		 offset: 0,		 time: 29,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 2,		 amount: 1,		 speed: 100,		 cone: 0,		 offset: 0,		 time: 30,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 2,		 amount: 1,		 speed: 100,		 cone: 0,		 offset: 0,		 time: 31,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 2,		 amount: 1,		 speed: 100,		 cone: 0,		 offset: 0,		 time: 32,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 2,		 amount: 1,		 speed: 100,		 cone: 0,		 offset: 0,		 time: 33,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 2,		 amount: 1,		 speed: 100,		 cone: 0,		 offset: 0,		 time: 34,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 2,		 amount: 1,		 speed: 100,		 cone: 0,		 offset: 0,		 time: 35,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 2,		 amount: 1,		 speed: 100,		 cone: 0,		 offset: 0,		 time: 36,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 2,		 amount: 1,		 speed: 100,		 cone: 0,		 offset: 0,		 time: 37,		 duration: 0,		 toPlayer: true},		{type: 2,		 id: 0,		 amount: 5,		 speed: 50,		 cone: 90,		 offset: 0,		 time: 48,		 duration: 5,		 toPlayer: false},		{type: 2,		 id: 0,		 amount: 5,		 speed: 50,		 cone: 70,		 offset: 0,		 time: 60,		 duration: 5,		 toPlayer: false},		{type: 2,		 id: 0,		 amount: 5,		 speed: 300,		 cone: 75,		 offset: 0,		 time: 75,		 duration: 2,		 toPlayer: false},		{type: 1,		 id: 3,		 amount: 5,		 speed: 300,		 cone: 75,		 offset: 0,		 time: 75,		 duration: 2,		 toPlayer: false},		{type: 2,		 id: 1,		 amount: 5,		 speed: 300,		 cone: 75,		 offset: 0,		 time: 77,		 duration: 2,		 toPlayer: false},		{type: 1,		 id: 4,		 amount: 5,		 speed: 300,		 cone: 75,		 offset: 0,		 time: 77,		 duration: 2,		 toPlayer: false},		{type: 2,		 id: 2,		 amount: 5,		 speed: 300,		 cone: 75,		 offset: 0,		 time: 79,		 duration: 2,		 toPlayer: false},		{type: 1,		 id: 5,		 amount: 5,		 speed: 300,		 cone: 75,		 offset: 0,		 time: 79,		 duration: 2,		 toPlayer: false},		{type: 1,		 id: 0,		 amount: 3,		 speed: 300,		 cone: 90,		 offset: 0,		 time: 82,		 duration: 10,		 toPlayer: false},		{type: 2,		 id: 1,		 amount: 3,		 speed: 300,		 cone: 90,		 offset: 0,		 time: 82,		 duration: 10,		 toPlayer: false},		{type: 1,		 id: 2,		 amount: 3,		 speed: 300,		 cone: 90,		 offset: 0,		 time: 82,		 duration: 10,		 toPlayer: false},		{type: 1,		 id: 4,		 amount: 3,		 speed: 300,		 cone: 90,		 offset: 0,		 time: 82,		 duration: 10,		 toPlayer: false},		{type: 2,		 id: 3,		 amount: 3,		 speed: 300,		 cone: 90,		 offset: 0,		 time: 82,		 duration: 10,		 toPlayer: false},		{type: 2,		 id: 5,		 amount: 3,		 speed: 300,		 cone: 90,		 offset: 0,		 time: 82,		 duration: 10,		 toPlayer: false},	]},
	  {	title: "No sight",	author: "FireCubeStudios",	enemies: 4,	duration: 20,	difficulty: "Easy",	advanced: false,	color1: "White",	color2: "White",	color3: "White",	color4: "#ffffff",	color5: "#ffffff",	spins: [	],	bullets: [		{type: 1,		 id: 0,		 amount: 1,		 speed: 150,		 cone: 0,		 offset: 0,		 time: 0,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 0,		 amount: 1,		 speed: 150,		 cone: 0,		 offset: 0,		 time: 1,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 0,		 amount: 1,		 speed: 150,		 cone: 0,		 offset: 0,		 time: 2,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 0,		 amount: 1,		 speed: 150,		 cone: 0,		 offset: 0,		 time: 3,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 0,		 amount: 1,		 speed: 150,		 cone: 0,		 offset: 0,		 time: 4,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 0,		 amount: 1,		 speed: 150,		 cone: 0,		 offset: 0,		 time: 5,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 0,		 amount: 1,		 speed: 150,		 cone: 0,		 offset: 0,		 time: 6,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 0,		 amount: 1,		 speed: 150,		 cone: 0,		 offset: 0,		 time: 7,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 0,		 amount: 1,		 speed: 150,		 cone: 0,		 offset: 0,		 time: 8,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 0,		 amount: 1,		 speed: 150,		 cone: 0,		 offset: 0,		 time: 9,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 0,		 amount: 1,		 speed: 150,		 cone: 0,		 offset: 0,		 time: 10,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 1,		 amount: 1,		 speed: 150,		 cone: 0,		 offset: 0,		 time: 1,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 2,		 amount: 1,		 speed: 150,		 cone: 0,		 offset: 0,		 time: 2,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 1,		 amount: 1,		 speed: 150,		 cone: 0,		 offset: 0,		 time: 3,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 1,		 amount: 1,		 speed: 150,		 cone: 0,		 offset: 0,		 time: 4,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 1,		 amount: 1,		 speed: 150,		 cone: 0,		 offset: 0,		 time: 5,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 1,		 amount: 1,		 speed: 150,		 cone: 0,		 offset: 0,		 time: 6,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 1,		 amount: 1,		 speed: 150,		 cone: 0,		 offset: 0,		 time: 7,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 1,		 amount: 1,		 speed: 150,		 cone: 0,		 offset: 0,		 time: 8,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 1,		 amount: 1,		 speed: 150,		 cone: 0,		 offset: 0,		 time: 9,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 1,		 amount: 1,		 speed: 150,		 cone: 0,		 offset: 0,		 time: 10,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 1,		 amount: 1,		 speed: 150,		 cone: 0,		 offset: 0,		 time: 11,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 2,		 amount: 1,		 speed: 150,		 cone: 0,		 offset: 0,		 time: 3,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 2,		 amount: 1,		 speed: 150,		 cone: 0,		 offset: 0,		 time: 4,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 2,		 amount: 1,		 speed: 150,		 cone: 0,		 offset: 0,		 time: 5,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 2,		 amount: 1,		 speed: 150,		 cone: 0,		 offset: 0,		 time: 6,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 2,		 amount: 1,		 speed: 150,		 cone: 0,		 offset: 0,		 time: 7,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 2,		 amount: 1,		 speed: 150,		 cone: 0,		 offset: 0,		 time: 8,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 2,		 amount: 1,		 speed: 150,		 cone: 0,		 offset: 0,		 time: 9,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 2,		 amount: 1,		 speed: 150,		 cone: 0,		 offset: 0,		 time: 10,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 2,		 amount: 1,		 speed: 150,		 cone: 0,		 offset: 0,		 time: 11,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 2,		 amount: 1,		 speed: 150,		 cone: 0,		 offset: 0,		 time: 12,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 1,		 amount: 1,		 speed: 150,		 cone: 0,		 offset: 0,		 time: 2,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 3,		 amount: 1,		 speed: 150,		 cone: 0,		 offset: 0,		 time: 3,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 3,		 amount: 1,		 speed: 150,		 cone: 0,		 offset: 0,		 time: 4,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 3,		 amount: 1,		 speed: 150,		 cone: 0,		 offset: 0,		 time: 5,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 3,		 amount: 1,		 speed: 150,		 cone: 0,		 offset: 0,		 time: 6,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 3,		 amount: 1,		 speed: 150,		 cone: 0,		 offset: 0,		 time: 7,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 3,		 amount: 1,		 speed: 150,		 cone: 0,		 offset: 0,		 time: 8,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 3,		 amount: 1,		 speed: 150,		 cone: 0,		 offset: 0,		 time: 9,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 3,		 amount: 1,		 speed: 150,		 cone: 0,		 offset: 0,		 time: 10,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 3,		 amount: 1,		 speed: 150,		 cone: 0,		 offset: 0,		 time: 11,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 3,		 amount: 1,		 speed: 150,		 cone: 0,		 offset: 0,		 time: 12,		 duration: 0,		 toPlayer: true},		{type: 1,		 id: 3,		 amount: 1,		 speed: 150,		 cone: 0,		 offset: 0,		 time: 13,		 duration: 0,		 toPlayer: true},	]},
	  {	title: "Darkness",	author: "FireCubeStudios",	enemies: 20,	duration: 15,	difficulty: "Simple",	advanced: false,	color1: "#121212",	color2: "#171717",	color3: "#1a1a1a",	color4: "#1f1f1f",	color5: "#000000",	spins: [		{ time: 15, speed: 1 },		{ time: 0, speed: 200 },		{ time: 1, speed: 20 },		{ time: 2, speed: 200 },		{ time: 3, speed: 20 },		{ time: 4, speed: 200 },		{ time: 5, speed: 20 },		{ time: 6, speed: 200 },		{ time: 7, speed: 20 },		{ time: 8, speed: 200 },		{ time: 9, speed: 20 },		{ time: 10, speed: 200 },		{ time: 11, speed: 20 },		{ time: 12, speed: 200 },		{ time: 13, speed: 20 },		{ time: 14, speed: 200 },		{ time: 15, speed: 200 },	],	bullets: [		{type: 1,		 id: 0,		 amount: 1,		 speed: 200,		 cone: 0,		 offset: 0,		 time: 0,		 duration: 0,		 toPlayer: false},		{type: 1,		 id: 1,		 amount: 1,		 speed: 200,		 cone: 0,		 offset: 0,		 time: 0,		 duration: 0,		 toPlayer: false},		{type: 1,		 id: 2,		 amount: 1,		 speed: 200,		 cone: 0,		 offset: 0,		 time: 0,		 duration: 0,		 toPlayer: false},		{type: 1,		 id: 3,		 amount: 1,		 speed: 200,		 cone: 0,		 offset: 0,		 time: 0,		 duration: 0,		 toPlayer: false},		{type: 1,		 id: 4,		 amount: 1,		 speed: 200,		 cone: 0,		 offset: 0,		 time: 0,		 duration: 0,		 toPlayer: false},		{type: 1,		 id: 5,		 amount: 1,		 speed: 200,		 cone: 0,		 offset: 0,		 time: 0,		 duration: 0,		 toPlayer: false},		{type: 1,		 id: 6,		 amount: 1,		 speed: 200,		 cone: 0,		 offset: 0,		 time: 0,		 duration: 0,		 toPlayer: false},		{type: 1,		 id: 7,		 amount: 1,		 speed: 200,		 cone: 0,		 offset: 0,		 time: 0,		 duration: 0,		 toPlayer: false},		{type: 1,		 id: 8,		 amount: 1,		 speed: 200,		 cone: 0,		 offset: 0,		 time: 0,		 duration: 0,		 toPlayer: false},		{type: 1,		 id: 9,		 amount: 1,		 speed: 200,		 cone: 0,		 offset: 0,		 time: 0,		 duration: 0,		 toPlayer: false},		{type: 1,		 id: 10,		 amount: 1,		 speed: 200,		 cone: 0,		 offset: 0,		 time: 0,		 duration: 0,		 toPlayer: false},		{type: 2,		 id: 20,		 amount: 1,		 speed: 200,		 cone: 0,		 offset: 0,		 time: 2,		 duration: 1,		 toPlayer: true},		{type: 2,		 id: 19,		 amount: 1,		 speed: 200,		 cone: 0,		 offset: 0,		 time: 3,		 duration: 1,		 toPlayer: true},		{type: 2,		 id: 18,		 amount: 1,		 speed: 200,		 cone: 0,		 offset: 0,		 time: 4,		 duration: 1,		 toPlayer: true},		{type: 2,		 id: 17,		 amount: 1,		 speed: 200,		 cone: 0,		 offset: 0,		 time: 5,		 duration: 1,		 toPlayer: true},		{type: 2,		 id: 16,		 amount: 1,		 speed: 200,		 cone: 0,		 offset: 0,		 time: 6,		 duration: 1,		 toPlayer: true},		{type: 2,		 id: 15,		 amount: 1,		 speed: 200,		 cone: 0,		 offset: 0,		 time: 7,		 duration: 1,		 toPlayer: true},		{type: 2,		 id: 14,		 amount: 1,		 speed: 200,		 cone: 0,		 offset: 0,		 time: 8,		 duration: 1,		 toPlayer: true},		{type: 2,		 id: 13,		 amount: 1,		 speed: 200,		 cone: 0,		 offset: 0,		 time: 9,		 duration: 1,		 toPlayer: true},		{type: 2,		 id: 12,		 amount: 1,		 speed: 200,		 cone: 0,		 offset: 0,		 time: 10,		 duration: 1,		 toPlayer: true},		{type: 2,		 id: 11,		 amount: 1,		 speed: 200,		 cone: 0,		 offset: 0,		 time: 11,		 duration: 1,		 toPlayer: true},		{type: 3,		 id: 0,		 amount: 1,		 speed: 200,		 cone: 0,		 offset: 0,		 time: 12,		 duration: 0,		 toPlayer: true},		{type: 3,		 id: 1,		 amount: 1,		 speed: 200,		 cone: 0,		 offset: 0,		 time: 12,		 duration: 0,		 toPlayer: true},		{type: 3,		 id: 2,		 amount: 1,		 speed: 200,		 cone: 0,		 offset: -1,		 time: 12,		 duration: 0,		 toPlayer: true},		{type: 3,		 id: 3,		 amount: 1,		 speed: 200,		 cone: 0,		 offset: -1,		 time: 13,		 duration: 0,		 toPlayer: true},		{type: 3,		 id: 4,		 amount: 1,		 speed: 200,		 cone: 0,		 offset: 0,		 time: 12,		 duration: 0,		 toPlayer: true},		{type: 3,		 id: 20,		 amount: 1,		 speed: 200,		 cone: 0,		 offset: 0,		 time: 13,		 duration: 0,		 toPlayer: true},		{type: 3,		 id: 13,		 amount: 1,		 speed: 200,		 cone: 0,		 offset: 0,		 time: 12,		 duration: 0,		 toPlayer: true},		{type: 3,		 id: 7,		 amount: 1,		 speed: 200,		 cone: 0,		 offset: 0,		 time: 12,		 duration: 0,		 toPlayer: true},		{type: 3,		 id: 18,		 amount: 1,		 speed: 200,		 cone: 0,		 offset: 0,		 time: 12,		 duration: 0,		 toPlayer: true},		{type: 3,		 id: 18,		 amount: 1,		 speed: 200,		 cone: 0,		 offset: 0,		 time: 13,		 duration: 0,		 toPlayer: true},		{type: 3,		 id: 18,		 amount: 1,		 speed: 200,		 cone: 0,		 offset: 0,		 time: 14,		 duration: 0,		 toPlayer: true},	]}
	];
	

  </script>
  <style>
  html, body {
	height: 99.5%;
	position: fixed;
	margin: 0;
}

canvas {
	width: 100%;
	height: 100%;
}

.menu {
	width: 100%;
	height: 100%;
	position: fixed;
	box-sizing: border-box;
	font-size: 20px;
	color: white;
	background: rgba(150,150,150,0.8);
}

#main-menu, #pause-menu {
	padding: 20%;
	text-align: center;
	text-shadow: 0 2px 2px gray;
}

#pause-menu, #pause-button {
	display: none
}

#level-selector, #settings {
	display: none;
	padding: 5%;
	text-shadow: 1px 0 2px black;
}

	#settings > .parameter {
		margin-bottom: 10px;
		padding: 5px;
		border: 1px solid black;
		border-radius: 10px;
		font-size: medium;
		color: black;
		text-shadow: none;
	}

		#settings > .parameter > .tip {
			font-size: small;
		}

.level {
	width: 100%;
	margin-bottom: 5%;
	border: 1px solid black;
	border-radius: 10px;
	box-sizing: border-box;
	padding: 5px;
	font-size: 16px;
	text-shadow: none;
	color: black;
	background: white;
}

.progress {
	width: 40px;
	height: 40px;
	position: relative;
	float: right;
	margin: 5px;
	border: 1px solid black;
	border-radius: 20px;
	box-sizing: border-box;
	padding-top: 10px;
	text-align: center;
}

button {
	width: 100%;
	height: 50px;
	margin-bottom: 15px;
	border: 2px solid black;
	border-radius: 15px;
	box-shadow: inset 0 0 4px 1px green;
}

#pause-button {
	display: none;
	position: fixed;
	top: 10px;
	right: 10px;
	width: auto;
	height: auto;
	padding: 2px;
	font-size: 20px;
}

a {
	color: black;
	text-decoration: none;
}

.back {
	position: relative;
	float: right;
	width: auto;
	height: auto;
	padding: 5px 10px;
	display: inline;
}

#score-div {
	display: none;
	width: 40%;
	height: 30%;
	position: fixed;
	top: 34%;
	Left: 30%;
	border: 1px solid black;
	border-radius: 50%;
	box-sizing: border-box;
	padding: 10% 0;
	text-align: center;
	background: white;
	box-shadow: inset 0 0 5px orange;
}

#score {
	position: fixed;
	top: 50%;
	left: 50%;
	width: 20%;
	height: 10%;
	margin: -5% 0 0 -10%;
	font-size: 40px;
}

/* LEVEL EDITOR STYLE BELOW */

#editor {
	display: none;
	width: 100%;
	height: 100%;
	position: fixed;
	padding: 0px;
	box-sizing: border-box;
	background: gray;
}

	#editor > .back {
		position: relative;
		float: right;
		width: calc(100% * 1 / 6 - 10px);
		height: calc(100% * 1 / 18 - 10px);
		margin: 5px;
		padding: 0;
	}

	#editor > canvas {
		width: calc(50% - 10px);
		height: calc(50% - 10px);
		position: fixed;
		top: 0;
		left: 0;
		margin: 5px;
		border: 2px solid black;
		box-sizing: border-box;
	}

#level-manager {
	display: none;
	position: fixed;
	width: 100%;
	height: 100%;
	padding: 5%;
}

	#level-manager > button {
		position: normal;
		width: calc(50% - 30px);
		height: 35px;
		margin: 15px;
		box-sizing: border-box;
	}

#meta-editor {
	display: none;
	position: fixed;
	padding-top: 20%;
	text-align: center;
}

#level-editor {
	display: none;
	position: fixed;
}

	#level-editor > canvas {
		position: fixed;
		left: 0;
		top: 0;
		width: 50%;
		height: 50%;
		border: 1px solid black;
		box-sizing: border-box;
	}

#timeline {
	position: fixed;
	left: 0;
	top: calc(100% * 7 / 12);
	width: 100%;
	height: 25%;
	border: 1px solid black;
	box-sizing: border-box;
}

#bullet-view, #spin-view {
	position: fixed;
	left: 0;
	top: calc(100% * 7 / 12);
	width: 100%;
	height: 25%;
	border: 2px solid white;
	box-sizing: border-box;
}

#spin-view {
	display: none
}

.bullet-spike {
	position: fixed;
	left: 10px;
	top: calc(100% * (7/12 + 1/8));
	width: 10px;
	height: 10px;
	margin-top: -5px;
	border: 2px solid darkblue;
	border-radius: 50% 50% 50% 0;
	background: blue;
}
#audio8
{
	display: none;
}
.spin-dot {
	position: fixed;
	left: 30px;
	top: calc(100% * (7/12 + 1/8));
	width: 10px;
	height: 10px;
	margin-top: -5px;
	border: 2px solid darkgreen;
	border-radius: 50% 50% 50% 0;
	background: green;
}

.bullet-spike:hover {
	border: 2px solid orange;
}

#curr-pos {
	position: fixed;
	top: inherit;
	left: 0%;
	width: 2px;
	height: 25%;
	background: darkred;
}

#time-left2, #time-left1, #time-right1, #time-right2, #time-play, #time-stop {
	position: fixed;
	bottom: 0;
	left: 0;
	width: 25%;
	height: calc(100% / 12);
	margin: 0;
}

#time-left1 {
	left: 25%
}

#time-right1 {
	left: 50%
}

#time-right2 {
	left: 75%
}

#time-play {
	bottom: calc(100% / 12)
}

#time-stop {
	left: 25%;
	bottom: calc(100% / 12)
}

#to-bullet-view {
	position: fixed;
	left: 0;
	top: 50%;
	width: 25%;
	height: calc(100% / 12);
}

#to-spin-view {
	position: fixed;
	left: 25%;
	top: 50%;
	width: 25%;
	height: calc(100% / 12);
}

#inspector {
	position: fixed;
	right: 0;
	top: calc(100% / 12);
	width: 50%;
	height: calc(100% * 5 / 12);
	padding: 2px;
	border: 1px solid black;
	box-sizing: border-box;
	font-size: small;
	text-align: right;
}

	#inspector > div > input {
		width: 50%;
		height: 16px;
		box-sizing: border-box;
	}

#new-bul-spin {
	width: 25%;
	height: calc(100% / 12);
	position: fixed;
	left: 50%;
	top: 50%;
}

#del-bul-spin {
	width: 25%;
	height: calc(100% / 12);
	position: fixed;
	left: 75%;
	top: 50%;
}

</style>
<script> function Vector(xy = [0, 0]) {
	this[0] = xy[0]; this[1] = xy[1];
}

Vector.prototype.add = function (xy) {
	return [this[0] + xy[0], this[1] + xy[1]]
}

Vector.prototype.adds = function (xy) {
	this[0] += xy[0]; this[1] += xy[1];
}

Vector.prototype.sub = function (xy) {
	return [this[0] - xy[0], this[1] - xy[1]]
}

Vector.prototype.subs = function (xy) {
	this[0] -= xy[0]; this[1] -= xy[1];
}

Vector.prototype.mult = function (num) {
	return [num * this[0], num * this[1]]
}

Vector.prototype.mults = function (num) {
	this[0] *= num; this[1] *= num;
}

Vector.prototype.div = function (num) {
	return [this[0] / num, this[1] / num]
}

Vector.prototype.divs = function (num) {
	this[0] /= num; this[1] /= num;
}

Vector.prototype.scale = function (xy) {
	return [this[0] * xy[0], this[1] * xy[1]]
}

Vector.prototype.scales = function (xy) {
	this[0] *= xy[0]; this[1] *= xy[1];
}

Vector.prototype.dot = function (xy) {
	return this[0] * xy[0] + this[1] * xy[1]
}

Object.defineProperty(Vector.prototype, 'x', {
	get: function () { return this[0] },
	set: function (x) { return this[0] = x }
})

Object.defineProperty(Vector.prototype, 'y', {
	get: function () { return this[1] },
	set: function (y) { return this[1] = y }
})

Object.defineProperty(Vector.prototype, 'xy', {
	get: function () { return [this[0], this[1]] },
	set: function (value) {
		this[0] = value[0]; this[1] = value[1];
		return [this[0], this[1]]
	}
})

Object.defineProperty(Vector.prototype, 'length', {
	get: function () { return Math.hypot(this[0], this[1]) },
	set: function (value) {
		let len = Math.hypot(this[0], this[1]);
		if (len == 0) return;
		this[0] *= value / len; this[1] *= value / len;
	}
});

Object.defineProperty(Vector.prototype, 'cos', {
	get: function () { return this[0] / Math.hypot(this[0], this[1]) }
})

Object.defineProperty(Vector.prototype, 'sin', {
	get: function () { return this[1] / Math.hypot(this[0], this[1]) }
})
// TRANSFORM DEFINITION ==========
function Transform() {
	this.matrix = [0, 0, 1, 1, 1, 0];
}

Transform.prototype.move = function (xy) {
	this.matrix[0] += xy[0];
	this.matrix[1] += xy[1];
}

Transform.prototype.rotate = function (angle) {
	let sina = this.matrix[5], cosa = this.matrix[4],
		sinb = Math.sin(angle), cosb = Math.cos(angle);
	this.matrix[5] = sina * cosda + cosa * sinda;
	this.matrix[4] = cosa * cosda - sina * sinda;
}

Transform.prototype.trig = function (vector) {
	this.matrix[4] = vector.cos;
	this.matrix[5] = vector.sin;
}

Transform.prototype.applyToPoint = function (xy) {
	let x, y, sx, sy, rotx, roty;
	//scaling
	sx = xy[0] * this.matrix[2];
	sy = xy[1] * this.matrix[3];
	//rotating
	rotx = sx * this.matrix[4] - sy * this.matrix[5];
	roty = sx * this.matrix[5] + sy * this.matrix[4];
	//translating
	x = rotx + this.matrix[0];
	y = roty + this.matrix[1];
	return [x, y];
}

Transform.prototype.applyToPath = function (path) {
	let newPath = [];
	let sx, sy, rotx, roty, x, y;

	for (let i = 0; i < path.length; i += 2) {
		//scaling
		sx = path[i] * this.matrix[2];
		sy = path[i + 1] * this.matrix[3];

		//rotating
		rotx = sx * this.matrix[4] - sy * this.matrix[5];
		roty = sx * this.matrix[5] + sy * this.matrix[4];

		//translating
		x = rotx + this.matrix[0];
		y = roty + this.matrix[1];

		newPath.push(x, y);
	}
	return newPath;
}

Object.defineProperty(Transform.prototype, 'position', {
	get: function () { return [this.matrix[0], this.matrix[1]] },
	set: function (xy) {
		this.matrix[0] = xy[0]; this.matrix[1] = xy[1]
	}
})

Object.defineProperty(Transform.prototype, 'scale', {
	get: function () { return [this.matrix[2], this.matrix[3]] },
	set: function (xy) {
		this.matrix[2] = xy[0]; this.matrix[3] = xy[1]
	}
})

Object.defineProperty(Transform.prototype, 'angle', {
	get: function () {
		return Math.atan2(this.matrix[5], this.matrix[4])
	},
	set: function (value) {
		this.matrix[4] = Math.cos(value);
		this.matrix[5] = Math.sin(value);
	}
})
// MESH DEFINITION ==========
var DrawMeshTarget; // canvas
function Mesh(path = []) {
	this.path = path;
}

Mesh.prototype.pushPoint = function (xy) {
	this.path.push(xy[0], xy[1]);
}

Mesh.prototype.createCircle = function (r, quality = 5) {
	this.path = [];
	let k = Math.ceil
		(2 * r * Math.PI / quality); // dots count
	let p = [r, 0];
	let t = new Transform;
	t.angle = 2 * Math.PI / k;

	while (k-- > 0) {
		this.pushPoint(p);
		p = t.applyToPoint(p);
	}
}

Mesh.prototype.draw = function (transform) {
	let path = transform.applyToPath(this.path);
	let target = DrawMeshTarget;

	target.beginPath();
	target.moveTo(path[0], path[1]);
	for (let i = 2; i < path.length; i += 2)
		target.lineTo(path[i], path[i + 1]);
	target.closePath();
	target.stroke();
}

Mesh.prototype.isInside = function (xy) {
	let x = xy[0], y = xy[1], x1, y1, x2, y2, count = 0;

	x1 = this.path[this.path.length - 2];
	y1 = this.path[this.path.length - 1];
	x2 = this.path[0]; y2 = this.path[1];

	if ((y - y1) * (y - y2) < 0)
		if ((x < x1) || (x < x2))
			if (x1 > x && x2 > x) count++;
			else {
				let k = (x2 - x1) * (y - y1) / (y2 - y1);
				if (k >= x - x1) count++;
			}

	for (let i = 2; i < this.path.length; i += 2) {
		x1 = this.path[i - 2]; y1 = this.path[i - 1];
		x2 = this.path[i]; y2 = this.path[i + 1];

		if ((y - y1) * (y - y2) >= 0) continue;
		if (x > x1 && x > x2) continue;
		if (x1 > x && x2 > x) {
			count++; continue;
		}

		let k = (x2 - x1) * (y - y1) / (y2 - y1);
		if (k >= x - x1) count++;
	}
	return count % 2 == 1;
}

// ====================

// SPRITE DEFINITION ==========

function Sprite() {
	this.mesh = new Mesh;
	this.transform = new Transform;
	this.fill = 'white';
	this.outline = 'black';
	this.behaviors = [];
}

Sprite.prototype.update = function () {
	this.behaviors.forEach(b => b.update());
}

Sprite.prototype.draw = function () {
	DrawMeshTarget.fillStyle = this.fill;
	DrawMeshTarget.strokeStyle = this.outline;
	this.mesh.draw(this.transform);
	DrawMeshTarget.fill();
	DrawMeshTarget.stroke();
}

Sprite.prototype.addBehavior = function (b) {
	b.container = this;
	this.behaviors.push(b);
}

// SETTINGS OBJECT ====

var Settings = {
	quality: 4
};

// INPUT HANDLER DEFINITION

var Input = {
	pos: new Vector, newpos: new Vector,
	//delta: new Vector,

	clicked: false, dragging: false,
	dragStart: false, dragEnd: false,
	dragStart: new Vector,

	ratio: new Vector,
	adjustment: 1
};function credits()
{
swal({
  title: 'Credits:',
  type:"info",
  
  html: true, 
  text: 'Programmer: FireCubeStudios		   <br />			  Coder: FireCubeStudios					<br />			  Art: FireCubeStudios <br /> This game was made for the <a href="https://itch.io/jam/musicgamejam2018">Music game jam 2018</a>',
  confirmButtonText: 'Ok'
})

}

// with self adjusting method [y = x^(5/4)]
Input.Delta = function () {
	let d = new Vector;
	d.xy = this.newpos.sub(this.pos);
	d.scales(this.ratio);
	d.mults(this.adjustment);
	d.length = Math.pow(d.length, 1.25);
	return d;
}

Input.update = function () {
	this.clicked = this.dragEnd = this.dragStart = false;
	this.pos.xy = this.newpos.xy
}

Input.handleClick = function (event) {
	this.clicked = true;
	this.newpos.xy = [event.screenX, event.screenY]
}

Input.handleDragStart = function (event) {
	this.dragging = this.dragStart = true;
	this.dragStart.xy = this.pos.xy = this.newpos.xy =
		[event.screenX, event.screenY];
	event.preventDefault();
}

Input.handleDragMove = function (event) {
	this.newpos.xy =
		[event.screenX, event.screenY]
	event.preventDefault();
}

Input.handleDragEnd = function (event) {
	this.dragging = false; this.dragEnd = true
}

Input.link = function (canvas) {
	canvas.onclick = e => this.handleClick(e);
	//touchstart
	//touchmove
	canvas.onmousedown = e => this.handleDragStart(e);
	canvas.onmousemove= e => this.handleDragMove(e);
	canvas.onmouseup = e => this.handleDragEnd(e);
//touchend
	setTimeout(() => {
		this.ratio.x = canvas.width / window.innerWidth;
		this.ratio.y = canvas.height / window.innerHeight;
	}, 200)
}

// ====================

// TIME HANDLING =====

var Time = {
	time: 0, // ms from now
	delta: 0, // ms
	_start: Date.now(),
	paused: false
};

Time.reset = function () {
	this._start = Date.now();
	this.time = 0;
}

Time.update = function () {
	let newTime = Date.now();
	if (!this.paused) {
		this.delta = newTime - this.time - this._start;
		this.time = newTime - this._start;
	}
	else {
		this.delta = 0;
		this._start = newTime - this.time;
	}
}

Time.pause = function () { this.paused = true }
Time.resume = function () { this.paused = false }

Object.defineProperty(Time, 's', {
	get: function () { return Time.time / 1000 }
})

Object.defineProperty(Time, 'dt', {
	get: function () { return Time.delta / 1000 }
})

// ====================

// SOME BEHAVIORS =====

function MeshCollider() {
	this.container = null;
	this.target = null; // other sprite

	// for cpu safe - using different collision modes
	this.mode = 'mesh'; // or 'dot'

	this.overlapped = false;
	this.colpoint = new Vector;
	this.oncollide = (xy) => { }; // collision point
	this.onoverlap = () => { };
}

MeshCollider.prototype.hasCollision = function () {
	let cp = this.container.transform.applyToPath
		(this.container.mesh.path);
	if (this.mode == 'dot') {
		let tmp = new Mesh(cp);
		let pos = this.target.transform.position;
		return tmp.isInside(pos);
	}

	let tp = this.target.transform.applyToPath
		(this.target.mesh.path);
	let count = 0;
	for (let i = 0; i < tp.length; i += 2) {
		let x = tp[i], y = tp[i + 1];
		let x1, y1, x2, y2;

		x1 = cp[cp.length - 2]; y1 = cp[cp.length - 1];
		x2 = cp[0]; y2 = cp[1];

		if ((y - y1) * (y - y2) < 0)
			if ((x < x1) || (x < x2))
				if (x1 > x && x2 > x) count++;
				else {
					let k = (x2 - x1) * (y - y1) / (y2 - y1);
					if (k >= x - x1) count++;
				}

		for (let i = 2; i < cp.length; i += 2) {
			x1 = cp[i - 2]; y1 = cp[i - 1];
			x2 = cp[i]; y2 = cp[i + 1];

			if ((y - y1) * (y - y2) >= 0) continue;
			if (x > x1 && x > x2) continue;
			if (x1 > x && x2 > x) {
				count++;
				continue;
			}
			{
				let k = (x2 - x1) * (y - y1) / (y2 - y1);
				if (k >= x - x1) count++;
			}
		}
		if (count % 2 == 1) {
			this.colpoint.xy = [x, y];
			return true;
		}
	}
	return false;
}

MeshCollider.prototype.update = function () {
	let collis = this.hasCollision();
	if (!this.overlapped && collis)
		this.oncollide(this.colpoint);
	else if (collis)
		this.onoverlap();
	this.overlapped = collis;
}

function BulletBehavior() {
	this.container = null;
	this.speed = new Vector; // px/s
	this.maxSpeed = Infinity;

	this.update = function () {
		let obj = this.container;
		let ds = this.speed.mult(Time.dt);
		obj.transform.move(ds);
	}

	this.stop = function () {
		this.speed.xy = [0, 0];
	}

	this.accelerate = function (xy) {
		this.speed.adds(xy);
		this.speed.length = Math.min
			(this.speed.length, this.maxSpeed);
	}

	this.rotateToward = function (xy, speed) {
		let dist = new Vector(xy);
		dist.subs(this.container.transform.position);

		let a1 = Math.atan2(this.speed.y, this.speed.x);
		let a2 = Math.atan2(dist.y, dist.x);

		let a = a2 - a1; if (a == 0) return;
		if (a < -Math.PI) a += 2 * Math.PI;
		else if (a > Math.PI) a -= 2 * Math.PI;

		let t = new Transform;
		if (a > 0) t.angle = Math.min(a, speed);
		else t.angle = 0 - Math.min(-a, speed);

		this.speed.xy = t.applyToPoint(this.speed);
	}
}

// ====================
// ++++++++++++++++++++
// LEVEL MANAGEMENT

function Level(id) {
	this.player = new Sprite;
	this.bound = new Sprite;
	this.progress = new Sprite;

	this.id = id;
	this.score = 1; this.ended = false;
	this.quality = 1; // [1...5]

	this.enemies = []; this.speed = 0;
	this.bullets = []; // â¬†ï¸angular velocity deg.

	// spetial data for level action
	this.levelData = null;
	this.bIndex = 0;
	this.sIndex = 0;
	/* format for this value:
	{
	  name: 'level name', author: 'author',
	  duration: null, // autosets in editor (in sec)
	  enemies: 4, // level enemies count
	  difficulty: 'normal',
  	
	  advanced: false, // change bg to black
	  color1: 'red', // for bullet #1
	  color2: 'orange', // for bullet #2
	  color3: 'yellow', // for bullet #3 (follower)
	  color4: 'green', // for bullet #4 (ball)
	  color5: 'blue', // for outline
  	
	  spins: [ // rotation motion of game field
		{
		  time: 4, // s from level start
		  speed: -30, // deg
		}, {}, ...
	  ],
	  bullets: [
		{
		  id: 2, // enemy id, which shoot
		  [toPlayer: true, // std to center ]
		  [type: 1, // (std 1=â–¶ï¸) 2=ðŸ”· 3=ðŸ”µ ]
		  [lifetime: 3, // s. For type=2 ]
		  amount: 5, // amount for one shoot
		  speed: 200, // px per second
		  time: 20, // s, from start level
		  duration: 0, // s, (0=one shoot)
		  cone: 30, // deg, cone angle
		  offset: -5 // deg, offset from target
		}
	  ]
	}
	*/
}

// define objects' meshes and transformation
Level.prototype.init = function () {
	let q = 10 / ((this.quality - 1) / 4 + 1);
	this.player.mesh.createCircle(12, q);
	this.bound.mesh.createCircle(280, 7 * q);
	this.progress.mesh.createCircle(280, 7 * q);

	this.player.transform.position =
		this.bound.transform.position =
		this.progress.transform.position =
		[300, 400];

	this.player.outline =
		this.bound.outline =
		this.progress.outline =
		this.lvlData.color5 || 'black';

	if (this.lvlData.advanced) {
		this.bound.fill = 'black';
		this.progress.fill = 'black';
	}
	this.progress.transform.scale = [0, 0];

	// define enemies
	let count = this.lvlData.enemies;
	for (let i = 0; i < count; i++) {
		let enemy = new Sprite;
		enemy.mesh.createCircle(30, 2 * q);
		enemy.transform.position = [300, 400];

		let a = i / count * 2 * Math.PI - Math.PI / 2;
		enemy.transform.move(
			[313 * Math.cos(a), 313 * Math.sin(a)]);
		enemy.angle = a + Math.PI / 2;

		enemy.outline = this.lvlData.color5 || 'black';
		this.enemies.push(enemy);
	}
}

// preloads all bullets and rotations
// in time ordered in the lvlData object
// + replaces continuous shoots with static
Level.prototype.preloadData = function (data) {
	let cop = a => { return Object.assign({}, a) };
	let bullets = data.bullets.map(cop);
	let spins = data.spins.map(cop);
	this.lvlData = Object.assign({}, data);
	this.lvlData.bullets = bullets;
	this.lvlData.spins = spins;

	// extracting continuos bullets
	for (let i = this.lvlData.bullets.length; i-- > 0;)
		if (this.lvlData.bullets[i].duration > 0) {
			let times = this.lvlData.bullets[i].duration;
			times = Math.floor(10 * times);

			while (times-- > 0) {
				let tmp = Object.assign
					({}, this.lvlData.bullets[i]);
				tmp.time += Math.floor(times) * 0.1;
				tmp.duration = 0;
				this.lvlData.bullets.push(tmp);
			}

			this.lvlData.bullets.splice(i, 1);
		}

	// sorting
	let s = (a, b) => { return a.time - b.time };
	this.lvlData.bullets.sort(s);
	this.lvlData.spins.sort(s);
}

// mainloop for gameplay
Level.prototype.start = function () {
	this.init();
	let level = this;
	this.mainloop = setInterval(function () {
		if (!Time.paused) level.handleInput();
		level.update();
	}, 1000 / 60);
	this.render();
}

// ends game
Level.prototype.end = function () {
	clearInterval(this.mainloop);
	this.ended = true;
}

// dont call manually!
Level.prototype.handleInput = function () {
	// applying player's position
	if (Input.dragging) {
		let speed = Input.Delta();
		this.player.transform.move(speed);

		// if out of bounds - go to center
		let p = this.player.transform.position;
		p = new Vector(p);
		p.subs([300, 400]);
		if (p.length > 280 - 12) {
			p.length = 280 - 12;
			p.adds([300, 400]);
			this.player.transform.position = p;
		}

		// setting scales and rotation
		let x = speed.length;
		if (x != 0) {
			this.player.transform.matrix[3] =
				Math.min(1, Math.exp(-x / 10));
			this.player.transform.matrix[2] =
				1 - 0.066 / (x + 0.2);
			this.player.transform.trig(speed);
		}
		else {
			let s = this.player.transform.scale;
			s = new Vector(s);
			s.mults(0.9); s.adds([0.1, 0.1]);
			this.player.transform.scale = s;
		}
	}
	else if (Input.dragEnd)
		this.player.transform.scale = [1, 1];
}

Level.prototype.update = function () {
	this.checkShoot();
	this.checkSpin();
	this.updateEnemies();
	this.updateBullets();
	this.updateProgress();
	Time.update();
	Input.update();
}

Level.prototype.checkShoot = function () {
	if (this.bIndex < this.lvlData.bullets.length &&
		this.lvlData.bullets[this.bIndex].time <= Time.s)
		this.shoot();
}

Level.prototype.shoot = function () {
	navigator.vibrate(10);
	let bul = this.lvlData.bullets[this.bIndex++];
	bul.offset *= Math.PI / 180;
	bul.cone *= Math.PI / 180;
	for (let i = 0; i < bul.amount; i++) {
		let bullet = new Sprite;
		bullet.transform.position =
			this.enemies[bul.id].transform.position;
		bullet.addBehavior(new BulletBehavior);

		if ((bul.type == 1) || (bul.type == 2)) {
			bullet.mesh = new Mesh([-30, -13, 0, 0, -30, 13]);
			if (bul.type == 1)
				bullet.fill = this.lvlData.color1 || 'gray';
			else
				bullet.fill = this.lvlData.color2 || 'gray';
		}
		else if (bul.type == 3) {
			bullet.mesh = new
				Mesh([0, 0, -17, 17, -34, 0, -17, -17]);
			let playerT = this.player.transform;
			bullet.behaviors[0].update = function () {
				if ((bullet.lifetime -= Time.dt) > 0) {
					let a = new Vector(playerT.position);
					//a.subs(bullet.transform.position);
					//this.accelerate(a.mult(0.75));
					this.rotateToward(a, Math.PI * Time.dt);
				}

				let s = bullet.behaviors[0].speed;
				bullet.transform.trig(s);
				bullet.transform.move(s.mult(Time.dt));
			}
			bullet.behaviors[0].maxSpeed = bul.speed;
			bullet.lifetime = bul.lifetime || 3;
			bullet.fill = this.lvlData.color3 || 'gray';
		}
		else if (bul.type == 4) {
			bullet.mesh.createCircle
				(30, 20 / ((this.quality - 1) / 4 + 1));
			bullet.fill = this.lvlData.color4 || 'gray';
		}

		if (bul.toPlayer) {
			let p = this.player.transform.position;
			let b = bullet.transform.position;
			let s = new Vector(p).sub(b);
			bullet.behaviors[0].speed.xy = s;
		}
		else {
			let b = bullet.transform.position;
			let s = new Vector([300, 400]).sub(b);
			bullet.behaviors[0].speed.xy = s;
		}

		let a = bul.offset;
		if (bul.amount > 1)
			a += (i / (bul.amount - 1) - 1 / 2) * bul.cone;

		let s = bullet.behaviors[0].speed;
		a += Math.atan2(s.y, s.x);
		bullet.behaviors[0].speed.xy = new Vector
			([Math.cos(a), Math.sin(a)]).mult(bul.speed);
		bullet.transform.trig(s);


		// collider here
		bullet.addBehavior(new MeshCollider);
		bullet.behaviors[1].mode = 'dot';
		bullet.behaviors[1].target = this.player;
		bullet.behaviors[1].oncollide = () => {
			if (bullet.fill != 'red') {
				bullet.fill = 'red';
				this.score -= 1 / this.lvlData.bullets.length;
				navigator.vibrate(50);
			}
		};

		this.bullets.push(bullet);
	}
}

Level.prototype.checkSpin = function () {
	if (this.sIndex >= this.lvlData.spins.length)
		return;
	let sp1 = this.lvlData.spins[this.sIndex];

	let sp2;
	if (this.sIndex + 1 < this.lvlData.spins.length)
		sp2 = this.lvlData.spins[this.sIndex + 1];
	else sp2 = { time: Infinity, speed: 0 };

	let ds = sp2.speed - sp1.speed;
	let dt = sp2.time - sp1.time;
	this.speed += ds / dt * Time.dt;
	if (Time.s > sp2.time) {
		this.speed = sp2.speed;
		this.sIndex++;
	}
}

Level.prototype.updateEnemies = function () {
	let da = this.speed * Math.PI / 180 * Time.dt;
	for (let enemy of this.enemies) {
		let t = enemy.transform.position;
		t = new Vector(t);
		t.subs([300, 400]);
		enemy.angle += da;
		let a = enemy.angle - Math.PI / 2;
		t = [300 + 310 * Math.cos(a),
		400 + 310 * Math.sin(a)];
		enemy.transform.position = t;
	}
}

Level.prototype.updateBullets = function () {
	for (let bullet of this.bullets)
		bullet.update();

	this.bullets = this.bullets.filter(bullet => {
		let pos = bullet.transform.position;
		pos = new Vector(pos);
		pos.subs([300, 400]);

		if (pos.length < 280) return true;

		let speed = bullet.behaviors[0].speed;
		return pos.dot(speed) < 0;
	});
}

Level.prototype.updateProgress = function () {
	let p = Time.s / this.lvlData.duration;
	p = Math.min(p, 1);
	this.progress.transform.scale = [p, p];

	if (Time.s - this.lvlData.duration > 2) {
		this.end();
		showScore(this.id, Math.max
			(0, Math.floor(100 * this.score)));
	}
}

Level.prototype.render = function () {
	let level = this;
	setTimeout(function r() {
		if (level.lvlData.advanced)
			DrawMeshTarget.fillStyle = 'black';
		else
			DrawMeshTarget.fillStyle = 'white';
		DrawMeshTarget.fillRect
			(0, 0, canvas.width, canvas.height);

		DrawMeshTarget.lineWidth = 2;
		level.bound.draw();
		DrawMeshTarget.lineWidth = 1;
		level.progress.draw();
		DrawMeshTarget.lineWidth = 2;
		level.player.draw();
		DrawMeshTarget.lineWidth = 0.75;
		for (let enemy of level.enemies)
			enemy.draw();
		for (let bullet of level.bullets)
			bullet.draw();

		if (!level.ended)
			window.requestAnimationFrame(r);
	}, 1000 / 60);
}

// ++++++++++++++++++++
// ====================

window.onload = function () {
	var canvas = document.getElementById('canvas');
	canvas.style.width = window.innerWidth + 'px';
	canvas.style.height = window.innerHeight + 'px';
	//canvas.width = window.innerWidth;
	//canvas.height = window.innerHeight;
	Input.link(canvas);
	DrawMeshTarget = canvas.getContext('2d');
	LevelEditor.init();
}

// ====================

// handle appearance in local mini screen
function TestLevel(lvlData) {
	this.level = new Level(LevelEditor.id);
	this.level.updateProgress = function () {
		let p = Time.s / this.lvlData.duration;
		p = Math.min(p, 1);
		this.progress.transform.scale = [p, p];
		if (Time.s - this.lvlData.duration > 2) {
			this.end();
			LevelEditor.stop();
			LevelEditor.isPlaying = false;
		}
	}
}

// grabs level data from editor
// (doesn't affect on source data)
TestLevel.prototype.updateData = function () {
	this.level.preloadData(LevelEditor.currLvlData);
}

TestLevel.prototype.startSimulation = function () {
	let t = Time._start;
	this.level.start();
	Time._start = t;
}

TestLevel.prototype.stopSimulation = function () {
	let t = Time._start;
	this.level.end();
	Time._start = t;
}

// ====================
// ####################
// LEVEL EDITOR

var LevelEditor = {
	gui: {
		mngr: null, meta: null, level: null,
		newBtn: null, back: null, save: null, canvas: null,
		tl: {}, // timeline gui
		insp: {}, // inspector gui
	},
	currLvlData: {},
	mode: 'manager',
	id: 0, // index of editing level
	testLevel: null,

	timepos: 0, // current time position
	isPlaying: false,
	zoom: 3, // zooming factor for timeline

	view: 'bullet' // switching bullet/spin view
};

LevelEditor.enter = function () {
	DrawMeshTarget = this.gui.canvas.getContext('2d');
	Input.link(this.gui.canvas);
	this.switchToManager();
	this.picked = undefined;
	this.hideInspector();
}

LevelEditor.leave = function () {
	Hide(edtr); Show(mmenu);
	if (this.testLevel != null)
		this.stop();
	DrawMeshTarget = canvas.getContext('2d');
}

LevelEditor.switchToManager = function () {
	Hide(this.gui.meta, this.gui.level,
		this.gui.save, this.gui.toMeta);
	this.refreshLevelList();
	Show(this.gui.mngr);
	this.mode = 'manager';
}

LevelEditor.switchToMeta = function () {
	Hide(this.gui.mngr, this.gui.level,
		this.gui.toMeta);
	Show(this.gui.meta, this.gui.save);
	this.gui.title.value = this.currLvlData.title;
	this.gui.author.value = this.currLvlData.author;
	this.gui.enemies.value = this.currLvlData.enemies;
	this.gui.dur.value = this.currLvlData.duration;
	this.gui.diff.value = this.currLvlData.difficulty;
	this.gui.col1.value = this.currLvlData.color1;
	this.gui.col2.value = this.currLvlData.color2;
	this.gui.col3.value = this.currLvlData.color3;
	this.gui.col4.value = this.currLvlData.color4;
	this.gui.col5.value = this.currLvlData.color5;
	this.gui.adv.checked = this.currLvlData.advanced;
	this.mode = 'meta';
}

LevelEditor.switchToLevel = function () {
	Hide(this.gui.mngr, this.gui.meta);
	Show(this.gui.level, this.gui.save,
		this.gui.toMeta);
	this.mode = 'level';
	// defining timeline zoom
	this.zoom = 100 / this.currLvlData.duration;
	this.initBullets();
	this.initSpins();
}

LevelEditor.createNewLevel = function () {
	levelsData.push({
		title: 'untitled', author: 'unknown',
		enemies: 6, duration: 10,
		difficulty: 'normal',
		spins: [], bullets: []
	});

	this.id = levelsData.length - 1;

	let copy = a => { return Object.assign({}, a) };
	let data = copy(levelsData[this.id]);
	data.bullets = levelsData[this.id].bullets.map(copy);
	data.spins = levelsData[this.id].spins.map(copy);
	this.currLvlData = data;
	this.switchToMeta();

	this.save();
}

/*LevelEditor.refreshLevelList = function () {
	let lvls = this.gui.mngr.
		getElementsByClassName('level');
	for (let i = lvls.length; i-- > 0;)
		lvls[i].parentNode.removeChild(lvls[i]);

	for (let i = 0; i < levelsData.length; i++) {
		let el = document.createElement('div');
		el.className = 'level';

		let data = levelsData[i];

		// creating progress span
		let score = document.createElement('span');
		score.className = 'progress';
		score.innerText =
			(userScores[i] || '0') + '%';
		el.appendChild(score);

		// creating info
		el.innerHTML += (data.title || 'untitled')
			+ '<br/>by ' + (data.author || 'unknown')
			+ '<br/>â­• ' + (data.enemies || '?')
			+ ' ðŸ•’ ' + (data.duration || '?')
			+ 's ' + (data.difficulty || '?');
		if (data.advanced)
			el.innerHTML += ' [advanced]';

		el.onclick = function () {
			let copy = a => { return Object.assign({}, a) };
			let data = copy(levelsData[i]);
			data.bullets = levelsData[i].bullets.map(copy);
			data.spins = levelsData[i].spins.map(copy);
			LevelEditor.currLvlData = data;
			LevelEditor.id = i;
			LevelEditor.testLevel = new TestLevel;
			LevelEditor.switchToMeta();
		}
		this.gui.mngr.appendChild(el);
	}
}*/

LevelEditor.save = function () {
	// finding data within the same position
	let d = levelsData[this.id];
	if (!d) {
		console.log('LevelEditor.save: cannot save data');
		return;
	}
	Object.assign(d, this.getCopy());
}

LevelEditor.getCopy = function () {
	let copy = a => { return Object.assign({}, a) };
	let data = copy(this.currLvlData);
	data.bullets = this.currLvlData.bullets.map(copy);
	data.spins = this.currLvlData.spins.map(copy);
	return data;
}
// TIMELINE FUNCTIONS ====================
LevelEditor.updateTimelinePos = function () {
	this.gui.tl.crt.style.left =
		Math.floor(this.timepos * this.zoom * 10) / 10 + '%';
}

LevelEditor.adjustCurrentTime = function (t) {
	this.timepos += t * 2;
	this.timepos = Math.max(0, this.timepos);
	this.updateTimelinePos();
}

LevelEditor.play = function () {
	// setting global timer to match current timepos
	Time.reset();
	Time.resume();
	this.pint = setInterval(function () {
		//Time.update();
		LevelEditor.timepos = Math.floor(Time.s * 10) / 10;
		LevelEditor.updateTimelinePos();
		//alert(Time.time);
	}, 100);
	this.testLevel = new TestLevel;
	this.testLevel.updateData();
	this.testLevel.startSimulation();
	Time._start -= this.timepos * 1000;
	//console.log('time paused: ' + Time.s);
}

LevelEditor.pause = function () {
	// pause global timer
	Time.pause(); this.timepos = Time.s;
	this.updateTimelinePos();
	clearInterval(this.pint);
	if (this.testLevel != undefined)
		this.testLevel.stopSimulation();
	//console.log('time paused: ' + Time.s);
}

LevelEditor.stop = function () {
	Time.reset(); this.pause(); this.timepos = 0;
}

// create bullet icons for each bullet in level
LevelEditor.initBullets = function () {
	// delete all what have
	while (this.gui.tl.bv.firstChild)
		this.gui.tl.bv.removeChild
			(this.gui.tl.bv.firstChild);
	this.bList = [];
	//create new
	let c = this.currLvlData.enemies;
	for (let bul of this.currLvlData.bullets) {
		let el = document.createElement('div');
		el.className = 'bullet-spike';
		el.style.left =
			Math.floor(bul.time * this.zoom) + '%';
		el.style.marginTop =
			Math.floor(25 * bul.id / c - 12.5) + '%';

		el.onclick = function () {
			this.style.border = '2px solid darkorange';
			LevelEditor.pickBullet(el);
		}

		this.gui.tl.bv.appendChild(el);
		this.bList.push({ el, bul });
	}
}

LevelEditor.initSpins = function () {
	while (this.gui.tl.sv.firstChild)
		this.gui.tl.sv.removeChild
			(this.gui.tl.sv.firstChild);
	this.sList = [];

	for (let sp of this.currLvlData.spins) {
		let el = document.createElement('div');
		el.className = 'spin-dot';
		el.style.left =
			Math.floor(sp.time * this.zoom) + '%';
		el.style.marginTop =
			Math.floor(-12.5 * sp.speed / 270) + '%';

		el.onclick = function () {
			LevelEditor.pickSpin(el);
		}

		this.gui.tl.sv.appendChild(el);
		this.sList.push({ el, sp });
	}
}

// INSPECTOR FUNCTIONS ====================

LevelEditor.pickBullet = function (elem) {
	for (let pair of this.bList) {
		if ((pair.el == elem) || (pair.bul == elem)) {
			pair.el.style.border = '2px solid red';
			pair.el.style.background = 'darkred';
			this.sendBulletToInspect(pair.bul);
		}
		else { // unselect other
			pair.el.style.border = '2px solid darkblue';
			pair.el.style.background = 'blue';
		}
	}
	// unpick spin
	for (let pair of this.sList) {
		pair.el.style.border = '2px solid darkgreen';
		pair.el.style.background = 'green';
	}
}

LevelEditor.pickSpin = function (elem) {
	for (let pair of this.sList) {
		if ((pair.el == elem) || (pair.sp == elem)) {
			pair.el.style.border = '2px solid red';
			pair.el.style.background = 'darkred';
			this.sendSpinToInspect(pair.sp);
		}
		else { // unselect other
			pair.el.style.border = '2px solid darkgreen';
			pair.el.style.background = 'green';
		}
	}
	// unpick bullet
	for (let pair of this.bList) {
		pair.el.style.border = '2px solid darkblue';
		pair.el.style.background = 'blue';
	}
}

LevelEditor.hideInspector = function () {
	Hide(this.gui.insp.bul, this.gui.insp.sp);
	Show(this.gui.insp.none);
}

LevelEditor.switchToBulletInspector = function () {
	Hide(this.gui.insp.none, this.gui.insp.sp);
	Show(this.gui.insp.bul);
}

LevelEditor.switchToSpinInspector = function () {
	Hide(this.gui.insp.none, this.gui.insp.bul);
	Show(this.gui.insp.sp);
}

LevelEditor.sendBulletToInspect = function (b) {
	this.picked = b;
	this.switchToBulletInspector();
	this.gui.insp.type.value = b.type;
	this.gui.insp.type.onchange = function () { b.type = +this.value }
	this.gui.insp.en.value = b.id;
	this.gui.insp.en.onchange = function () {
	b.id = +this.value;
		LevelEditor.initBullets()
	}
	this.gui.insp.am.value = b.amount;
	this.gui.insp.am.onchange = function () { b.amount = +this.value }
	this.gui.insp.bspd.value = b.speed;
	this.gui.insp.bspd.onchange = function () { b.speed = +this.value }
	this.gui.insp.cone.value = b.cone;
	this.gui.insp.cone.onchange = function () { b.cone = +this.value }
	this.gui.insp.off.value = b.offset;
	this.gui.insp.off.onchange = function () { b.offset = +this.value }
	this.gui.insp.btm.value = b.time;
	this.gui.insp.btm.onchange = function () {
	b.time = +this.value;
		LevelEditor.initBullets()
	}
	this.gui.insp.dur.value = b.duration;
	this.gui.insp.dur.onchange = function () { b.duration = +this.value }
	this.gui.insp.twrd.checked = b.toPlayer;
	this.gui.insp.twrd.onchange = function () { b.toPlayer = this.checked }
}

LevelEditor.sendSpinToInspect = function (s) {
	this.picked = s;
	this.switchToSpinInspector();
	this.gui.insp.stm.value = s.time;
	this.gui.insp.stm.onchange = function () {
	s.time = +this.value;
		LevelEditor.initSpins()
	}
	this.gui.insp.sspd.value = s.speed;
	this.gui.insp.sspd.onchange = function () {
	s.speed = +this.value;
		LevelEditor.initSpins()
	}
}

LevelEditor.createNewBullet = function () {
	let b;
	if (this.picked == undefined)
		b = {
			type: 1, id: 0, amount: 1, speed: 150,
			cone: 0, offset: 0, toPlayer: true,
			time: LevelEditor.timepos++, duration: 0
		}
	else {
		b = Object.assign({}, this.picked);
		b.time += 1;
	}

	this.currLvlData.bullets.push(b);
	this.initBullets();
	this.pickBullet(b);
	this.sendBulletToInspect(b);
}

LevelEditor.createNewSpin = function () {
	let s;
	if (this.picked == undefined)
		s = {
			time: LevelEditor.timepos++, speed: 0
		}
	else {
		s = Object.assign({}, this.picked);
		s.time += 1;
	}

	this.currLvlData.spins.push(s);
	this.initSpins();
	this.pickSpin(s);
	this.sendSpinToInspect(s);
}

LevelEditor.deletePicked = function () {
	let o = this.picked;
	let b = this.currLvlData.bullets;
	let s = this.currLvlData.spins;

	if (o == undefined) {
		console.log('error: nothing to delete');
		return;
	}

	for (let i = 0; i < b.length; i++)
		if (b[i] == o) {
			this.currLvlData.bullets.splice(i, 1);
			this.initBullets();
			this.hideInspector();
			delete this.picked; return;
		}

	for (let i = 0; i < s.length; i++)
		if (s[i] == o) {
			this.currLvlData.spins.splice(i, 1);
			this.initSpins();
			this.hideInspector();
			delete this.picked; return;
		}

	console.log('error: nothing deleted');
}

// PRELOADING EDITOR GUI ===============

LevelEditor.init = function () { // loading elements
	LevelEditor.gui.mngr =
		document.getElementById('level-manager');
	LevelEditor.gui.level =
		document.getElementById('level-editor');
	LevelEditor.gui.meta =
		document.getElementById('meta-editor');
	LevelEditor.gui.newBtn =
		document.getElementById('new-lvl');
	LevelEditor.gui.back =
		document.getElementById('return');
	LevelEditor.gui.save =
		document.getElementById('save');
	LevelEditor.gui.toMeta =
		document.getElementById('to-meta');

	LevelEditor.gui.title =
		document.getElementById('meta-title');
	LevelEditor.gui.author =
		document.getElementById('meta-author');
	LevelEditor.gui.enemies =
		document.getElementById('meta-enemies');
	LevelEditor.gui.dur =
		document.getElementById('meta-duration');
	LevelEditor.gui.diff =
		document.getElementById('meta-difficulty');
	LevelEditor.gui.col1 =
		document.getElementById('meta-color1');
	LevelEditor.gui.col2 =
		document.getElementById('meta-color2');
	LevelEditor.gui.col3 =
		document.getElementById('meta-color3');
	LevelEditor.gui.col4 =
		document.getElementById('meta-color4');
	LevelEditor.gui.col5 =
		document.getElementById('meta-color5');
	LevelEditor.gui.adv =
		document.getElementById('meta-advanced');

	LevelEditor.gui.canvas =
		document.getElementById('editor-canvas');

	LevelEditor.gui.back.onclick = function () {
		if (LevelEditor.mode == 'meta')
			LevelEditor.switchToLevel();
		else LevelEditor.leave();
	}
	LevelEditor.gui.save.onclick = () => {
		if (this.mode == 'meta') {
			this.currLvlData.title = this.gui.title.value;
			this.currLvlData.author = this.gui.author.value;
			this.currLvlData.enemies =
				this.gui.enemies.value;
			this.currLvlData.duration = this.gui.dur.value;
			this.currLvlData.difficulty = this.gui.diff.value;
			this.currLvlData.color1 = this.gui.col1.value;
			this.currLvlData.color2 = this.gui.col2.value;
			this.currLvlData.color3 = this.gui.col3.value;
			this.currLvlData.color4 = this.gui.col4.value;
			this.currLvlData.color5 = this.gui.col5.value;
			this.currLvlData.advanced = this.gui.adv.checked;
			this.switchToLevel();
		}
		else if (this.mode == 'level') {
			this.pause(); this.save();
			alert('successfully saved!');
			if (confirm('want to copy to clipboard?')) {
				let d = this.currLvlData;
				let str = '{\n';
				str += '\ttitle: "' + d.title + '",\n';
				str += '\tauthor: "' + d.author + '",\n';
				str += '\tenemies: ' + d.enemies + ',\n';
				str += '\tduration: ' + d.duration + ',\n';
				str += '\tdifficulty: "' + d.difficulty + '",\n';
				str += '\tadvanced: ' + d.advanced + ',\n';
				str += '\tcolor1: "' + d.color1 + '",\n';
				str += '\tcolor2: "' + d.color2 + '",\n';
				str += '\tcolor3: "' + d.color3 + '",\n';
				str += '\tcolor4: "' + d.color4 + '",\n';
				str += '\tcolor5: "' + d.color5 + '",\n';
				str += '\tspins: [\n';
				for (let s of d.spins)
					str += '\t\t{ time: ' + s.time + ', speed: ' + s.speed + ' },\n';
				str += '\t],\n\tbullets: [\n';
				for (let b of d.bullets) {
					str += '\t\t{type: ' + b.type + ', ';
					str += '\t\tid: ' + b.id + ', ';
					str += '\t\tamount: ' + b.amount + ', ';
					str += '\t\tspeed: ' + b.speed + ', ';
					str += '\t\tcone: ' + b.cone + ', ';
					str += '\t\toffset: ' + b.offset + ', ';
					str += '\t\ttime: ' + b.time + ', ';
					str += '\t\tduration: ' + b.duration + ', ';
					str += '\t\ttoPlayer: ' + b.toPlayer + '},\n';
				}
				str += '\t]\n}';

				let i = document.createElement('input');
				document.body.appendChild(i);
				i.value = str; i.select();
				document.execCommand('copy');
				document.body.removeChild(i);
			}
		}
	}
	LevelEditor.gui.toMeta.onclick = () => {
		this.switchToMeta();
	}
	LevelEditor.gui.newBtn.onclick = function () {
		LevelEditor.createNewLevel();
		LevelEditor.refreshLevelList();
	}

	LevelEditor.gui.tl.left2 =
		document.getElementById('time-left2');
	LevelEditor.gui.tl.left1 =
		document.getElementById('time-left1');
	LevelEditor.gui.tl.right1 =
		document.getElementById('time-right1');
	LevelEditor.gui.tl.right2 =
		document.getElementById('time-right2');
	LevelEditor.gui.tl.play =
		document.getElementById('time-play');
	LevelEditor.gui.tl.stop =
		document.getElementById('time-stop');
	LevelEditor.gui.tl.crt =
		document.getElementById('curr-pos');

	LevelEditor.gui.tl.bv =
		document.getElementById('bullet-view');
	LevelEditor.gui.tl.sv =
		document.getElementById('spin-view');
	LevelEditor.gui.tl.tobv =
		document.getElementById('to-bullet-view');
	LevelEditor.gui.tl.tosv =
		document.getElementById('to-spin-view');

	LevelEditor.gui.tl.left2.onclick = function () {
		LevelEditor.adjustCurrentTime(-2);
	}
	LevelEditor.gui.tl.left1.onclick = function () {
		LevelEditor.adjustCurrentTime(-1);
	}
	LevelEditor.gui.tl.right1.onclick = function () {
		LevelEditor.adjustCurrentTime(1);
	}
	LevelEditor.gui.tl.right2.onclick = function () {
		LevelEditor.adjustCurrentTime(2);
	}
	LevelEditor.gui.tl.play.onclick = function () {
		//console.log(LevelEditor.isPlaying)
		if (LevelEditor.isPlaying) {
			LevelEditor.pause();
			LevelEditor.isPlaying = false;
		}
		else {
			LevelEditor.play();
			LevelEditor.isPlaying = true;
		}
	}
	LevelEditor.gui.tl.stop.onclick = function () {
		LevelEditor.isPlaying = false;
		LevelEditor.stop();
	}
	LevelEditor.gui.tl.tobv.onclick = function () {
		Hide(LevelEditor.gui.tl.sv);
		Show(LevelEditor.gui.tl.bv);
		LevelEditor.view = 'bullet';
	}
	LevelEditor.gui.tl.tosv.onclick = function () {
		Hide(LevelEditor.gui.tl.bv);
		Show(LevelEditor.gui.tl.sv);
		LevelEditor.view = 'spin';
	}

	// inspectors elements loading
	LevelEditor.gui.insp.none =
		document.getElementById('empty-inspect');
	LevelEditor.gui.insp.bul =
		document.getElementById('bullet-inspect');
	LevelEditor.gui.insp.type =
		document.getElementById('insp-type');
	LevelEditor.gui.insp.en =
		document.getElementById('insp-enemy');
	LevelEditor.gui.insp.am =
		document.getElementById('insp-amount');
	LevelEditor.gui.insp.bspd =
		document.getElementById('insp-bspeed');
	LevelEditor.gui.insp.cone =
		document.getElementById('insp-cone');
	LevelEditor.gui.insp.off =
		document.getElementById('insp-offset');
	LevelEditor.gui.insp.btm =
		document.getElementById('insp-btime');
	LevelEditor.gui.insp.dur =
		document.getElementById('insp-duration');
	LevelEditor.gui.insp.twrd =
		document.getElementById('insp-to-player');
	LevelEditor.gui.insp.sp =
		document.getElementById('spin-inspect');
	LevelEditor.gui.insp.stm =
		document.getElementById('insp-stime');
	LevelEditor.gui.insp.sspd =
		document.getElementById('insp-sspeed');

	LevelEditor.gui.newObj =
		document.getElementById('new-bul-spin');
	LevelEditor.gui.delObj =
		document.getElementById('del-bul-spin');

	LevelEditor.gui.newObj.onclick = function () {
		if (LevelEditor.view == 'bullet')
			LevelEditor.createNewBullet();
		else if (LevelEditor.view == 'spin')
			LevelEditor.createNewSpin();
		else console.log('creation error');
	}

	LevelEditor.gui.delObj.onclick = function () {
		try { LevelEditor.deletePicked() }
		catch (e) { console.log('cant delete') }
	}
}</script>
</body>
</html>
	</body>
</html>